package com.library.management.model;

import java.time.LocalDate;
import java.util.Objects;

/**
 * Represents a borrowing transaction in the Library Management System.
 * <p>
 * Each transaction records when a user borrows a book, when it is returned (if returned),
 * and the current status of that borrowing activity.
 *
 * <p>This class is central to tracking book loans and user borrowing history.
 *
 * <p>Example usage:
 * <pre>
 *     Transaction transaction = new Transaction(userId, bookId, LocalDate.now());
 * </pre>
 *
 * @author Fardaws Jawad
 *
 * @see com.library.management.model.Status
 * @see com.library.management.model.BorrowingHistory
 */
public class Transaction {

    /** Unique ID for the transaction (generated by the database). */
    private int transactionId;

    /** ID of the user who initiated the borrowing. */
    private int userId;

    /** ID of the book being borrowed. */
    private int bookId;

    /** Date when the book was borrowed. */
    private LocalDate borrowDate;

    /** Date when the book was returned. If null, the book is still borrowed. */
    private LocalDate returnDate;

    /** Status of the transaction (BORROWED or RETURNED). */
    private Status status;

    //-----------------------------------------------------------------------
    /**
     * Default constructor.
     * Useful for frameworks that require a no-argument constructor (e.g., JDBC, Hibernate).
     */
    public Transaction() {
    }

    /**
     * Constructs a Transaction with all fields including transaction ID.
     * Typically used when reading transaction records from the database.
     *
     * @param transactionId the unique transaction ID
     * @param userId        the user ID associated with the transaction
     * @param bookId        the book ID associated with the transaction
     * @param borrowDate    the date the book was borrowed
     * @param returnDate    the date the book was returned
     * @param status        current status of the transaction
     */
    public Transaction(int transactionId, int userId, int bookId, LocalDate borrowDate,
                       LocalDate returnDate, Status status) {

        this (userId, bookId, borrowDate, returnDate, status);
        this.transactionId = transactionId;
    }

    /**
     * Constructs a Transaction without a transaction ID.
     * Useful when creating a new transaction before saving to the database.
     *
     * @param userId     the user ID
     * @param bookId     the book ID
     * @param borrowDate the date the book was borrowed
     * @param returnDate the date the book was returned
     * @param status     the current status of the transaction
     */
    public Transaction(int userId, int bookId, LocalDate borrowDate,
                       LocalDate returnDate, Status status) {

        this (userId, bookId, borrowDate);
        this.returnDate = returnDate;
        this.status = status;
    }

    /**
     * Constructs a new Transaction when a user borrows a book.
     * Sets returnDate to {@code null} and status to {@code BORROWED} by default.
     *
     * @param userId     the user ID
     * @param bookId     the book ID
     * @param borrowDate the date the book was borrowed
     */
    public Transaction(int userId, int bookId, LocalDate borrowDate) {
        this.userId = userId;
        this.bookId = bookId;
        this.borrowDate = borrowDate;
        this.returnDate = null;
        this.status = Status.BORROWED;
    }

    //-----------------------------------------------------------------------
    /** @return the unique ID of the transaction */
    public int getTransactionId() {
        return transactionId;
    }

    /** @param transactionId sets the unique transaction ID */
    public void setTransactionId(int transactionId) {
        this.transactionId = transactionId;
    }

    /** @return the ID of the user who borrowed the book */
    public int getUserId() {
        return userId;
    }

    /** @param userId sets the ID of the borrowing user */
    public void setUserId(int userId) {
        this.userId = userId;
    }

    /** @return the ID of the borrowed book */
    public int getBookId() {
        return bookId;
    }

    /** @param bookId sets the ID of the borrowed book */
    public void setBookId(int bookId) {
        this.bookId = bookId;
    }

    /** @return the date the book was borrowed */
    public LocalDate getBorrowDate() {
        return borrowDate;
    }

    /** @param borrowDate sets the date the book was borrowed */
    public void setBorrowDate(LocalDate borrowDate) {
        this.borrowDate = borrowDate;
    }

    /** @return the return date of the book, or {@code null} if not returned */
    public LocalDate getReturnDate() {
        return returnDate;
    }

    /** @param returnDate sets the return date of the book */
    public void setReturnDate(LocalDate returnDate) {
        this.returnDate = returnDate;
    }

    /** @return the current status of the transaction */
    public Status getStatus() {
        return status;
    }

    /** @param status sets the current status of the transaction */
    public void setStatus(Status status) {
        this.status = status;
    }

    //-----------------------------------------------------------------------
    /**
     * Returns a string representation of the transaction for display or debugging.
     *
     * @return a formatted string of the transaction details
     */
    @Override
    public String toString() {
        return "Transaction Details:\n" +
                "  Transaction ID  : " + transactionId + "\n" +
                "  User ID         : " + userId + "\n" +
                "  Book ID         : " + bookId + "\n" +
                "  Borrow Date     : " + borrowDate + "\n" +
                "  Return Date     : " + (returnDate != null ? returnDate : "Not Returned") + "\n" +
                "  Status          : " + status + "\n";
    }

    /**
     * Compares this transaction to another based on transaction ID.
     *
     * @param object the object to compare with
     * @return true if both have the same transaction ID
     */
    @Override
    public boolean equals(Object object) {
        if (this == object) return true;
        if (object == null || getClass() != object.getClass()) return false;
        Transaction that = (Transaction) object;
        return transactionId == that.transactionId;
    }

    /**
     * Generates a hash code based on transaction ID.
     *
     * @return the hash code for this transaction
     */
    @Override
    public int hashCode() {
        return Objects.hashCode(transactionId);
    }
}
